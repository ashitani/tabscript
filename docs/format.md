# TabScript フォーマット仕様

## 基本構文

### メタデータ
- `$title="曲名"` - 曲のタイトル
- `$tuning="guitar"` - チューニング（デフォルトは"guitar"）
- `$beat="4/4"` - 拍子（デフォルトは"4/4"）

### セクション
- `[セクション名]` - 新しいセクションの開始

### 小節
- 小節は改行で区切る
- 1行に1小節を記述
- コメントは`#`で始まる行、または行末に`#`以降

### 音符
- `弦-フレット:音価` - 基本形式（例：`3-3:4`は3弦3フレットの4分音符）
- 音価を省略すると直前の音価を継承
- 弦番号を省略すると直前の弦番号を継承
- `r音価` - 休符（例：`r4`は4分休符）
- `(音符1 音符2):音価` - 和音（例：`(3-3 4-4):4`）

### コード
- `@コード名` - コード名の指定（例：`@Cmaj7`）
- コード名は次のコード指定まで有効

### 繰り返し構造

小節の繰り返しとn番カッコを表現するための記法です：

#### 基本的な繰り返し
```
{  # 繰り返し開始
3-3:4 4-4:4  # この小節は2回繰り返される
}  # 繰り返し終了
```

#### n番カッコ
```
{  # 繰り返し開始
3-3:4 4-4:4  # 共通部分
{1  # 1番カッコ開始
5-5:4 6-6:4  # 1番カッコの中身
1}  # 1番カッコ終了
{2  # 2番カッコ開始
1-1:4 2-2:4  # 2番カッコの中身
2}  # 2番カッコ終了
}  # 繰り返し終了
```

#### 入れ子の繰り返し
```
{  # 外側の繰り返し開始
3-3:4 4-4:4
{  # 内側の繰り返し開始
5-5:4 6-6:4
}  # 内側の繰り返し終了
}  # 外側の繰り返し終了
```

## 例
```
$title="Sample Song"
$beat="4/4"

[Intro]
@Cmaj7 3-3:4 4-4:4  # 1小節目
{  # 繰り返し開始
@Dm7 5-5:4 6-6:4    # 2小節目
{1  # 1番カッコ開始
@Em7 3-3:4 4-4:4    # 3小節目
1}　# 1番カッコ終了、繰り返し開始に戻る
{2  # 2番カッコ開始
@Am7 1-1:4 2-2:4    # 3小節目（別バージョン）
2} # 2番カッコ終了 
} # 繰り返し開始に戻らないでループを抜ける
```

## メタデータ

ファイルの先頭に記述する設定情報です：

- `$title="..."` : 曲のタイトル
- `$tuning="..."` : 楽器とチューニング
  - `"guitar"` : 6弦ギター（標準）
  - `"guitar7"` : 7弦ギター
  - `"bass"` : 4弦ベース
  - `"bass5"` : 5弦ベース
  - `"ukulele"` : ウクレレ
- `$beat="..."` : 拍子（例: "4/4", "3/4"）

## セクション

曲の構造を表す区切りです：

```
[Intro]  # イントロ
[A]      # Aメロ
[B]      # Bメロ
[Chorus] # サビ
```

## 音符の記法

### 基本形式
```
弦番号-フレット番号:音価
```
例：
- `1-3:4` : 1弦の3フレットを4分音符で
- `6-0:8` : 6弦の開放弦を8分音符で

### 休符
```
r音価
```
例：
- `r4` : 4分休符
- `r8` : 8分休符

### 和音
```
(弦-フレット 弦-フレット ...):音価
```
例：
- `(1-3 2-5 3-4):4` : 3つの音を同時に4分音符で

### ミュート
```
弦-x
```
または
```
弦-X
```
例：
- `6-x:8` : 6弦をミュートして8分音符で
- `(1-3 2-5 6-x):4` : 和音の中でミュート

### 音価
- `1` : 全音符
- `2` : 2分音符
- `4` : 4分音符
- `8` : 8分音符
- `16` : 16分音符
- `.` : 付点（例: `8.`は付点8分音符）

### 省略記法

直前の設定を継承することで、記述を簡略化できます：

1. 弦番号の省略（直前の弦番号を継承）：
```
3-0:8 2 3 5  # 全て3弦で演奏
```

2. 音価の省略（直前の音価を継承）：
```
3-0:8 4-0 5-0  # 全て8分音符
```

## コード

コードネームを`@`で始めて記述します：
```
@Am 6-0:4 5-0:4  # Amコードを表示
```

小節の途中でコードを変更する場合：
```
@Am 6-0:4 @C 5-3:4  # 途中でAmからCに変更
```

## 省略可能な要素とデフォルト値

以下の要素は省略可能です：

### メタデータ
- `$title` - デフォルト: `""`（空文字列）
- `$tuning` - デフォルト: `"guitar"`（6弦ギター）
- `$beat` - デフォルト: `"4/4"`
- `$bars_per_line` - デフォルト: `4`（1行あたりの小節数）

### セクション
- セクション名（`[名前]`）- デフォルト: `""`（空文字列）
  - セクション名を省略すると、セクション名が表示されません

### 音符
- 弦番号 - デフォルト: 直前の音符の弦番号（初期値は`1`）
- 音価（`:8`など） - デフォルト: 直前の音符の音価（初期値は`4`=4分音符）
- コード名（`@Am`など） - デフォルト: なし

### 例：省略記法の使用

```
# フル記法
$title="Example"
$tuning="guitar"
$beat="4/4"

[A]
@Am 6-0:4 5-0:4 4-0:4 3-0:4

# 最小限の記法（全て省略）
6-0 5-0 4-0 3-0

# 音価を1回だけ指定（継承される）
6-0:8 5-0 4-0 3-0

# 弦番号の継承と相対指定
6-0 d0 d0 d0  # 6弦→5弦→4弦→3弦
```

## コメント

TabScriptでは以下の3種類のコメントをサポートしています：

### 行頭コメント
行頭に`#`を置くことで、その行全体をコメントとして扱います：
```
# これは行全体がコメントになります
3-3:4 4-4:4  # これは行末コメント
```

### 複数行コメント
`'''`または`"""`で囲まれた部分を複数行コメントとして扱います：
```
'''
これは複数行
コメントです
'''
3-3:4 4-4:4
```

### 行末コメント
行の途中に`#`を置くことで、その位置から行末までをコメントとして扱います。
コードネーム（`@A#m7`など）内の`#`を除き、`#`以降は全て無視されます：
```
3-3:4 4-4:4  # これは行末コメント（以降は全て無視）
@A#m7 5-5:4  # コードネーム内の#は保護されます
5-5:4 # ここからコメント 6-6:4 @Am 7-7:4  # この音符とコードは無視されます
```
注意：行末コメントの後に音符を置くことは推奨されません。

## スラーとタイ

音符の後に`&`を付けることで、次の音符とのスラーまたはタイを表現できます：

```
# スラー（異なる音程をつなぐ）
3-3:4& 3-5:4

# タイ（同じ音程をつなぐ）
3-3:4& 3-3:4

# 3音以上の連続したスラー
3-3:8& 3-5:8& 3-7:8 3-8:8

# 3音以上の連続したタイ（同じ音を延ばす）
3-3:4& 3-3:4& 3-3:4 # 3つの音符を繋げて4分音符3つ分の長さに
```

スラー/タイは小節をまたいで使用することもできます：
```
3-3:4& | 3-5:4

# 小節をまたぐ3音以上のスラー
3-3:4& | 3-5:4& 3-7:4
```

## リピート（繰り返し）記号

小節の前後に`|:`と`:|`を配置することで、その部分を繰り返すことを指示できます：

```
# 基本的な繰り返し
|: 3-3:4 4-4:4 :| # この2小節を2回繰り返す

# 1番カッコ、2番カッコ付きの繰り返し
|: 3-3:4 4-4:4 :|1 5-5:4 6-6:4 :|2 1-1:4 2-2:4 :|

# 複数の繰り返し番号を同時に指定
|: 3-3:4 4-4:4 :|1,2 5-5:4 6-6:4 :|3 1-1:4 2-2:4 :|

# 繰り返し回数の明示的な指定
|[2]: 3-3:4 4-4:4 :|  # 2回繰り返し
|[3]: 3-3:4 4-4:4 :|  # 3回繰り返し
```

### リピート記号の種類

- `|:` - 繰り返し開始（オプションで`|[n]:`で繰り返し回数を指定可能）
- `:|` - 繰り返し終了
- `:|n` - n番カッコ付き繰り返し終了（例：`:|1`、`:|2`）
- `:|n,m` - 複数の番号を持つカッコ（例：`:|1,2`は1,2番カッコを表す）
