# TabScript レイアウト構造

このドキュメントでは、TabScriptのレンダリングにおけるレイアウト構造と各要素の位置関係について説明します。

## 目次

- [基本的なレイアウト構造](#基本的なレイアウト構造)
- [小節内の詳細構造](#小節内の詳細構造)
- [スタイル設定](#スタイル設定)
- [要素の描画ルール](#要素の描画ルール)

## 基本的なレイアウト構造

基本的なレイアウト構造については、`docs/layout_overview.txt`を参照してください。

## 小節内の詳細構造

小節内の詳細構造については、`docs/layout_bar_detail.txt`を参照してください。

## スタイル設定

TabScriptのレイアウトは、以下のスタイル設定によって制御されます。これらの値を調整することで、タブ譜の見た目をカスタマイズできます。

### 基本的な間隔

| 設定名 | 説明 | デフォルト値 |
|--------|------|------------|
| `string_spacing` | 弦と弦の間隔 | 3mm |
| `section_spacing` | セクション間の間隔 | 5mm |

### 縦方向のマージン

| 設定名 | 説明 | デフォルト値 |
|--------|------|------------|
| `title_margin_bottom` | タイトルの下のマージン | 5mm |
| `metadata_margin_bottom` | メタデータの下のマージン | 5mm |
| `section_name_margin_bottom` | セクション名の下のマージン | 8mm |

### 相対位置

| 設定名 | 説明 | デフォルト値 |
|--------|------|------------|
| `chord_offset` | コードと1弦の間隔 | 2.5mm |
| `volta_bracket_offset` | ボルタブラケット（n番カッコ）と1弦の間隔 | 10mm |
| `volta_number_offset` | ボルタ番号とブラケットの間隔 | 3.2mm |
| `repeat_dot_offset` | リピート記号のドットのオフセット | 3mm |

### 行の高さ

| 設定名 | 説明 | デフォルト値 |
|--------|------|------------|
| `normal_row_height` | 通常の行の高さ | 22mm |
| `volta_row_height` | ボルタブラケットを含む行の高さ | 35mm |

### 線の太さ

| 設定名 | 説明 | デフォルト値 |
|--------|------|------------|
| `normal_line_width` | 通常の線の太さ | 1.0 |
| `repeat_line_width` | リピート記号の線の太さ | 2.5 |
| `volta_line_width` | ボルタブラケットの線の太さ | 1.0 |

### その他の設定

| 設定名 | 説明 | デフォルト値 |
|--------|------|------------|
| `repeat_dot_size` | リピート記号のドットのサイズ | 0.25mm |
| `repeat_line_spacing` | リピート記号の線の間隔 | 1.2mm |
| `volta_margin` | ボルタブラケットの小節境界からのマージン | 0.5mm |
| `string_bottom_margin` | 1弦からの下マージン（ボルタ線など） | 1mm |

## 要素の描画ルール

### ボルタブラケット（n番カッコ）

ボルタブラケットは、繰り返し演奏時の異なる終結部を示すために使用されます。

- **上線**: `volta_start`または`volta_end`が`True`の場合に描画
- **左線**: `volta_start`が`True`の場合に描画
- **右線**: `volta_end`が`True`の場合に描画
- **数字**: `volta_start`が`True`の場合に描画（ピリオド付き）

### リピート記号

リピート記号は、楽譜の繰り返し部分を示すために使用されます。

- **開始記号**: `is_repeat_start`が`True`の場合に描画
  - 太線、細線、2つのドットで構成
- **終了記号**: `is_repeat_end`が`True`の場合に描画
  - 細線、太線、2つのドットで構成

### スラー/タイ

スラーとタイは、音符間の接続を示すために使用されます。

- **小節内**: 音符の`connect_next`が`True`の場合、次の音符との間に描画
- **小節間**: 小節の最後の音符の`connect_next`が`True`の場合、次の小節の最初の音符との間に描画
- **行末/行頭**: 行をまたぐ場合は半分ずつ描画